WARNING:tensorflow:`period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
WARNING  `period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
2023-04-04 10:27:59.012443: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count >= 8, compute capability >= 0.0): 4
2023-04-04 10:27:59.012729: I tensorflow/core/grappler/clusters/single_machine.cc:357] Starting new session
2023-04-04 10:27:59.035133: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78600 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:17:00.0, compute capability: 8.0
2023-04-04 10:27:59.036104: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 78600 MB memory:  -> device: 1, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:65:00.0, compute capability: 8.0
2023-04-04 10:27:59.037055: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:2 with 78600 MB memory:  -> device: 2, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:ca:00.0, compute capability: 8.0
2023-04-04 10:27:59.037978: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:3 with 78600 MB memory:  -> device: 3, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:e3:00.0, compute capability: 8.0
2023-04-04 10:27:59.064146: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1137] Optimization results for grappler item: graph_to_optimize
  function_optimizer: function_optimizer did nothing. time = 0.03ms.
  function_optimizer: function_optimizer did nothing. time = 0.001ms.
Epoch 1/10
WARNING:tensorflow:From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
WARNING  From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
2023-04-04 10:27:59.320281: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
37/37 - 7s - loss: 0.4994 - accuracy: 0.8137 - auc: 0.5210 - precision: 0.2388 - recall: 0.0189 - balanced_accuracy: 0.5024 - val_loss: 0.4577 - val_accuracy: 0.8209 - val_auc: 0.6049 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - val_balanced_accuracy: 0.5000
Epoch 2/10
37/37 - 0s - loss: 0.4726 - accuracy: 0.8196 - auc: 0.5883 - precision: 0.4507 - recall: 0.0378 - balanced_accuracy: 0.5145 - val_loss: 0.4339 - val_accuracy: 0.8260 - val_auc: 0.6860 - val_precision: 1.0000 - val_recall: 0.0283 - val_balanced_accuracy: 0.5117
Epoch 3/10
2023-04-04 10:28:05.383061: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
37/37 - 0s - loss: 0.4544 - accuracy: 0.8247 - auc: 0.6316 - precision: 0.5810 - recall: 0.0720 - balanced_accuracy: 0.5311 - val_loss: 0.4182 - val_accuracy: 0.8328 - val_auc: 0.7191 - val_precision: 0.9375 - val_recall: 0.0708 - val_balanced_accuracy: 0.5368
Epoch 4/10
37/37 - 0s - loss: 0.4388 - accuracy: 0.8308 - auc: 0.6689 - precision: 0.6825 - recall: 0.1015 - balanced_accuracy: 0.5458 - val_loss: 0.4066 - val_accuracy: 0.8488 - val_auc: 0.7407 - val_precision: 0.9459 - val_recall: 0.1651 - val_balanced_accuracy: 0.5777
Epoch 5/10
37/37 - 0s - loss: 0.4313 - accuracy: 0.8361 - auc: 0.6860 - precision: 0.7448 - recall: 0.1275 - balanced_accuracy: 0.5604 - val_loss: 0.3980 - val_accuracy: 0.8488 - val_auc: 0.7529 - val_precision: 0.8511 - val_recall: 0.1887 - val_balanced_accuracy: 0.5860
Epoch 6/10
37/37 - 0s - loss: 0.4159 - accuracy: 0.8433 - auc: 0.7191 - precision: 0.7869 - recall: 0.1700 - balanced_accuracy: 0.5790 - val_loss: 0.3915 - val_accuracy: 0.8539 - val_auc: 0.7619 - val_precision: 0.8545 - val_recall: 0.2217 - val_balanced_accuracy: 0.6013
Epoch 7/10
37/37 - 0s - loss: 0.4199 - accuracy: 0.8376 - auc: 0.7097 - precision: 0.7167 - recall: 0.1523 - balanced_accuracy: 0.5695 - val_loss: 0.3865 - val_accuracy: 0.8530 - val_auc: 0.7693 - val_precision: 0.8276 - val_recall: 0.2264 - val_balanced_accuracy: 0.6030
Epoch 8/10
37/37 - 0s - loss: 0.4050 - accuracy: 0.8397 - auc: 0.7387 - precision: 0.7095 - recall: 0.1759 - balanced_accuracy: 0.5795 - val_loss: 0.3815 - val_accuracy: 0.8514 - val_auc: 0.7741 - val_precision: 0.8000 - val_recall: 0.2264 - val_balanced_accuracy: 0.6020
Epoch 9/10
37/37 - 0s - loss: 0.3909 - accuracy: 0.8458 - auc: 0.7662 - precision: 0.7532 - recall: 0.2054 - balanced_accuracy: 0.5951 - val_loss: 0.3784 - val_accuracy: 0.8514 - val_auc: 0.7780 - val_precision: 0.7903 - val_recall: 0.2311 - val_balanced_accuracy: 0.6047
Epoch 10/10
37/37 - 0s - loss: 0.3879 - accuracy: 0.8458 - auc: 0.7711 - precision: 0.7159 - recall: 0.2290 - balanced_accuracy: 0.6028 - val_loss: 0.3754 - val_accuracy: 0.8530 - val_auc: 0.7818 - val_precision: 0.7794 - val_recall: 0.2500 - val_balanced_accuracy: 0.6126
Epoch 00010: val_loss improved from inf to 0.37540, saving model to /home/zadubrov/output/results_train/AR_single-labeled_Fold-0.model.weights.hdf5
INFO     Computation time for training the single-label model for AR: 0.21 min
<IPython.core.display.HTML object>
<class 'tuple'>	2	(1889,)
<class 'numpy.ndarray'>	4735


Permutation explainer:   0%|                                                                                                 | 4/4735 [02:19<61:14:33, 46.60s/it]
Traceback (most recent call last):
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 415, in <module>
    main()
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 392, in main
    train(fixed_opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 190, in train
    sl.train_single_label_models(df=df, opts=opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 551, in train_single_label_models
    performance = fit_and_evaluate_model(x_train=x_train, x_test=x_test, y_train=y_train, y_test=y_test,
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 422, in fit_and_evaluate_model
    sd.shap_explain(x_train, model, target, opts.outputDir, drop_values=True, threshold=10, save_values=True)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/shap_dfpl.py", line 22, in shap_explain
    shap_values = explainer(x_train_to_explain)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/explainers/_permutation.py", line 68, in __call__
    return super().__call__(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/explainers/_permutation.py", line 82, in __call__
    return super().__call__(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/explainers/_explainer.py", line 266, in __call__
    row_result = self.explain_row(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/explainers/_permutation.py", line 140, in explain_row
    outputs = fm(masks, zero_index=0, batch_size=batch_size)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/utils/_masked_model.py", line 57, in __call__
    return self._delta_masking_call(masks, zero_index=zero_index, batch_size=batch_size)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/utils/_masked_model.py", line 203, in _delta_masking_call
    outputs = self.model(*subset_masked_inputs)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/shap/models/_model.py", line 26, in __call__
    out = self.inner_model(*args)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/keras/engine/training.py", line 1751, in predict
    tmp_batch_outputs = self.predict_function(iterator)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/eager/def_function.py", line 885, in __call__
    result = self._call(*args, **kwds)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/eager/def_function.py", line 924, in _call
    results = self._stateful_fn(*args, **kwds)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/eager/function.py", line 3038, in __call__
    filtered_flat_args) = self._maybe_define_function(args, kwargs)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/eager/function.py", line 3459, in _maybe_define_function
    return self._define_function_with_shape_relaxation(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/eager/function.py", line 3335, in _define_function_with_shape_relaxation
    (cache_key_args, cache_key_kwargs) = nest.map_structure(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 868, in map_structure
    return pack_sequence_as(
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 757, in pack_sequence_as
    return _pack_sequence_as(structure, flat_sequence, expand_composites)
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 632, in _pack_sequence_as
    final_index, packed = _packed_nest_with_indices(structure, flat_sequence,
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 598, in _packed_nest_with_indices
    packed.append(sequence_fn(s, child))
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 188, in _sequence_like
    elif is_namedtuple(instance) or _is_attrs(instance):
KeyboardInterrupt