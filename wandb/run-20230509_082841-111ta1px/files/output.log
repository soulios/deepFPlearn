WARNING:tensorflow:`period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
WARNING  `period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
2023-05-09 08:29:04.673294: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count >= 8, compute capability >= 0.0): 4
2023-05-09 08:29:04.673584: I tensorflow/core/grappler/clusters/single_machine.cc:357] Starting new session
2023-05-09 08:29:04.741416: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78600 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:17:00.0, compute capability: 8.0
2023-05-09 08:29:04.743275: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 78600 MB memory:  -> device: 1, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:65:00.0, compute capability: 8.0
2023-05-09 08:29:04.744672: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:2 with 78600 MB memory:  -> device: 2, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:ca:00.0, compute capability: 8.0
2023-05-09 08:29:04.746298: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:3 with 78600 MB memory:  -> device: 3, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:e3:00.0, compute capability: 8.0
2023-05-09 08:29:04.782996: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1137] Optimization results for grappler item: graph_to_optimize
  function_optimizer: function_optimizer did nothing. time = 0.056ms.
  function_optimizer: function_optimizer did nothing. time = 0.003ms.
WARNING:tensorflow:From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
WARNING  From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
2023-05-09 08:29:05.056285: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
Epoch 1/10
2023-05-09 08:29:13.494971: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
37/37 - 9s - loss: 0.4989 - accuracy: 0.8120 - auc: 0.5255 - precision: 0.2208 - recall: 0.0201 - balanced_accuracy: 0.5026 - val_loss: 0.4591 - val_accuracy: 0.8201 - val_auc: 0.5981 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - val_balanced_accuracy: 0.4995
Epoch 2/10
37/37 - 1s - loss: 0.4811 - accuracy: 0.8135 - auc: 0.5780 - precision: 0.3448 - recall: 0.0472 - balanced_accuracy: 0.5137 - val_loss: 0.4397 - val_accuracy: 0.8252 - val_auc: 0.6693 - val_precision: 0.7778 - val_recall: 0.0330 - val_balanced_accuracy: 0.5142
Epoch 3/10
37/37 - 0s - loss: 0.4520 - accuracy: 0.8243 - auc: 0.6453 - precision: 0.5620 - recall: 0.0803 - balanced_accuracy: 0.5350 - val_loss: 0.4258 - val_accuracy: 0.8361 - val_auc: 0.7019 - val_precision: 0.8750 - val_recall: 0.0991 - val_balanced_accuracy: 0.5436
Epoch 4/10
37/37 - 1s - loss: 0.4376 - accuracy: 0.8325 - auc: 0.6782 - precision: 0.6570 - recall: 0.1334 - balanced_accuracy: 0.5599 - val_loss: 0.4154 - val_accuracy: 0.8438 - val_auc: 0.7209 - val_precision: 0.9091 - val_recall: 0.1415 - val_balanced_accuracy: 0.5638
Epoch 5/10
37/37 - 1s - loss: 0.4303 - accuracy: 0.8348 - auc: 0.6869 - precision: 0.6757 - recall: 0.1476 - balanced_accuracy: 0.5658 - val_loss: 0.4072 - val_accuracy: 0.8463 - val_auc: 0.7350 - val_precision: 0.8947 - val_recall: 0.1604 - val_balanced_accuracy: 0.5731
Epoch 6/10
37/37 - 1s - loss: 0.4125 - accuracy: 0.8437 - auc: 0.7235 - precision: 0.7512 - recall: 0.1889 - balanced_accuracy: 0.5884 - val_loss: 0.4002 - val_accuracy: 0.8471 - val_auc: 0.7470 - val_precision: 0.8780 - val_recall: 0.1698 - val_balanced_accuracy: 0.5777
Epoch 7/10
37/37 - 0s - loss: 0.4131 - accuracy: 0.8401 - auc: 0.7216 - precision: 0.6957 - recall: 0.1889 - balanced_accuracy: 0.5883 - val_loss: 0.3944 - val_accuracy: 0.8497 - val_auc: 0.7578 - val_precision: 0.8864 - val_recall: 0.1840 - val_balanced_accuracy: 0.5885
Epoch 8/10
INFO     Computation time for training the single-label model for AR: 0.27 min
Traceback (most recent call last):
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 392, in <module>
    main()
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 369, in main
    train(fixed_opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 234, in train
    sl.train_single_label_models(df=df, opts=opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 558, in train_single_label_models
    performance = fit_and_evaluate_model(x_train=x_train, x_test=x_test, y_train=y_train, y_test=y_test,
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 433, in fit_and_evaluate_model
    makedirs(shap_path, exit_ok=True)
TypeError: makedirs() got an unexpected keyword argument 'exit_ok'
37/37 - 0s - loss: 0.4002 - accuracy: 0.8460 - auc: 0.7417 - precision: 0.7418 - recall: 0.2137 - balanced_accuracy: 0.5983 - val_loss: 0.3897 - val_accuracy: 0.8505 - val_auc: 0.7649 - val_precision: 0.8723 - val_recall: 0.1934 - val_balanced_accuracy: 0.5923
Epoch 9/10
37/37 - 1s - loss: 0.3931 - accuracy: 0.8477 - auc: 0.7556 - precision: 0.7316 - recall: 0.2349 - balanced_accuracy: 0.6056 - val_loss: 0.3846 - val_accuracy: 0.8514 - val_auc: 0.7722 - val_precision: 0.8913 - val_recall: 0.1934 - val_balanced_accuracy: 0.5927
Epoch 10/10
37/37 - 0s - loss: 0.3837 - accuracy: 0.8515 - auc: 0.7740 - precision: 0.7466 - recall: 0.2574 - balanced_accuracy: 0.6192 - val_loss: 0.3803 - val_accuracy: 0.8522 - val_auc: 0.7788 - val_precision: 0.8491 - val_recall: 0.2123 - val_balanced_accuracy: 0.6008
Epoch 00010: val_loss improved from inf to 0.38035, saving model to /gpfs0/home/zadubrov/deepFPlearn_exai/example/results_train/AR_single-labeled_Fold-0.model.weights.hdf5