WARNING:tensorflow:`period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
WARNING  `period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
Epoch 1/10
2023-05-09 08:32:26.607188: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count >= 8, compute capability >= 0.0): 4
2023-05-09 08:32:26.608189: I tensorflow/core/grappler/clusters/single_machine.cc:357] Starting new session
2023-05-09 08:32:26.648493: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78600 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:17:00.0, compute capability: 8.0
2023-05-09 08:32:26.650072: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 78600 MB memory:  -> device: 1, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:65:00.0, compute capability: 8.0
2023-05-09 08:32:26.651409: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:2 with 78600 MB memory:  -> device: 2, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:ca:00.0, compute capability: 8.0
2023-05-09 08:32:26.652798: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:3 with 78600 MB memory:  -> device: 3, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:e3:00.0, compute capability: 8.0
2023-05-09 08:32:26.685302: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1137] Optimization results for grappler item: graph_to_optimize
  function_optimizer: function_optimizer did nothing. time = 0.051ms.
  function_optimizer: function_optimizer did nothing. time = 0.003ms.
WARNING:tensorflow:From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
WARNING  From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
2023-05-09 08:32:26.939146: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
2023-05-09 08:32:31.748792: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
37/37 - 6s - loss: 0.4937 - accuracy: 0.8108 - auc: 0.5579 - precision: 0.3040 - recall: 0.0449 - balanced_accuracy: 0.5106 - val_loss: 0.4356 - val_accuracy: 0.8285 - val_auc: 0.6694 - val_precision: 1.0000 - val_recall: 0.0425 - val_balanced_accuracy: 0.5207
Epoch 2/10
37/37 - 1s - loss: 0.4741 - accuracy: 0.8144 - auc: 0.6061 - precision: 0.4149 - recall: 0.0921 - balanced_accuracy: 0.5318 - val_loss: 0.4199 - val_accuracy: 0.8404 - val_auc: 0.7044 - val_precision: 1.0000 - val_recall: 0.1085 - val_balanced_accuracy: 0.5501
Epoch 3/10
37/37 - 0s - loss: 0.4480 - accuracy: 0.8281 - auc: 0.6546 - precision: 0.5797 - recall: 0.1417 - balanced_accuracy: 0.5611 - val_loss: 0.4065 - val_accuracy: 0.8480 - val_auc: 0.7309 - val_precision: 1.0000 - val_recall: 0.1509 - val_balanced_accuracy: 0.5692
Epoch 4/10
37/37 - 0s - loss: 0.4324 - accuracy: 0.8298 - auc: 0.6894 - precision: 0.5972 - recall: 0.1488 - balanced_accuracy: 0.5651 - val_loss: 0.3975 - val_accuracy: 0.8497 - val_auc: 0.7460 - val_precision: 0.9722 - val_recall: 0.1651 - val_balanced_accuracy: 0.5797
Epoch 5/10
37/37 - 0s - loss: 0.4237 - accuracy: 0.8378 - auc: 0.7018 - precision: 0.6537 - recall: 0.1983 - balanced_accuracy: 0.5882 - val_loss: 0.3918 - val_accuracy: 0.8505 - val_auc: 0.7543 - val_precision: 0.9730 - val_recall: 0.1698 - val_balanced_accuracy: 0.5816
Epoch 6/10
37/37 - 1s - loss: 0.4116 - accuracy: 0.8382 - auc: 0.7293 - precision: 0.6627 - recall: 0.1948 - balanced_accuracy: 0.5867 - val_loss: 0.3870 - val_accuracy: 0.8505 - val_auc: 0.7612 - val_precision: 0.9268 - val_recall: 0.1792 - val_balanced_accuracy: 0.5852
Epoch 7/10
37/37 - 0s - loss: 0.4102 - accuracy: 0.8416 - auc: 0.7294 - precision: 0.6844 - recall: 0.2125 - balanced_accuracy: 0.5960 - val_loss: 0.3832 - val_accuracy: 0.8505 - val_auc: 0.7656 - val_precision: 0.8723 - val_recall: 0.1934 - val_balanced_accuracy: 0.5896
Epoch 8/10
INFO     Computation time for training the single-label model for AR: 0.21 min
Traceback (most recent call last):
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 392, in <module>
    main()
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 369, in main
    train(fixed_opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 234, in train
    sl.train_single_label_models(df=df, opts=opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 558, in train_single_label_models
    performance = fit_and_evaluate_model(x_train=x_train, x_test=x_test, y_train=y_train, y_test=y_test,
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 435, in fit_and_evaluate_model
    pickle.dump(model, pkl)
TypeError: cannot pickle 'weakref' object
37/37 - 0s - loss: 0.3974 - accuracy: 0.8433 - auc: 0.7512 - precision: 0.6817 - recall: 0.2326 - balanced_accuracy: 0.6067 - val_loss: 0.3788 - val_accuracy: 0.8514 - val_auc: 0.7725 - val_precision: 0.8214 - val_recall: 0.2170 - val_balanced_accuracy: 0.5984
Epoch 9/10
37/37 - 1s - loss: 0.3868 - accuracy: 0.8477 - auc: 0.7702 - precision: 0.7086 - recall: 0.2527 - balanced_accuracy: 0.6158 - val_loss: 0.3760 - val_accuracy: 0.8530 - val_auc: 0.7759 - val_precision: 0.8167 - val_recall: 0.2311 - val_balanced_accuracy: 0.6049
Epoch 10/10
37/37 - 0s - loss: 0.3853 - accuracy: 0.8456 - auc: 0.7699 - precision: 0.6737 - recall: 0.2656 - balanced_accuracy: 0.6190 - val_loss: 0.3742 - val_accuracy: 0.8514 - val_auc: 0.7779 - val_precision: 0.7727 - val_recall: 0.2406 - val_balanced_accuracy: 0.6065
Epoch 00010: val_loss improved from inf to 0.37423, saving model to /gpfs0/home/zadubrov/deepFPlearn_exai/example/results_train/AR_single-labeled_Fold-0.model.weights.hdf5