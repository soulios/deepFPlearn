WARNING:tensorflow:`period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
WARNING  `period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
2023-05-09 08:43:48.602214: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count >= 8, compute capability >= 0.0): 4
2023-05-09 08:43:48.602658: I tensorflow/core/grappler/clusters/single_machine.cc:357] Starting new session
2023-05-09 08:43:48.707750: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78600 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:17:00.0, compute capability: 8.0
2023-05-09 08:43:48.709261: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 78600 MB memory:  -> device: 1, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:65:00.0, compute capability: 8.0
2023-05-09 08:43:48.713371: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:2 with 78600 MB memory:  -> device: 2, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:ca:00.0, compute capability: 8.0
2023-05-09 08:43:48.714902: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:3 with 78600 MB memory:  -> device: 3, name: NVIDIA A100 80GB PCIe, pci bus id: 0000:e3:00.0, compute capability: 8.0
2023-05-09 08:43:48.749095: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1137] Optimization results for grappler item: graph_to_optimize
  function_optimizer: function_optimizer did nothing. time = 0.056ms.
  function_optimizer: function_optimizer did nothing. time = 0.004ms.
WARNING:tensorflow:From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
WARNING  From /home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/site-packages/tensorflow/python/ops/math_ops.py:3777: tensor_shape_from_node_def_name (from tensorflow.python.framework.graph_util_impl) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.graph_util.tensor_shape_from_node_def_name`
2023-05-09 08:43:49.010447: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
Epoch 1/10
2023-05-09 08:43:56.355601: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
37/37 - 8s - loss: 0.5034 - accuracy: 0.8068 - auc: 0.5318 - precision: 0.1852 - recall: 0.0236 - balanced_accuracy: 0.5017 - val_loss: 0.4518 - val_accuracy: 0.8201 - val_auc: 0.6323 - val_precision: 0.3333 - val_recall: 0.0047 - val_balanced_accuracy: 0.5011
Epoch 2/10
37/37 - 1s - loss: 0.4744 - accuracy: 0.8141 - auc: 0.6036 - precision: 0.3830 - recall: 0.0638 - balanced_accuracy: 0.5198 - val_loss: 0.4323 - val_accuracy: 0.8285 - val_auc: 0.6842 - val_precision: 0.8000 - val_recall: 0.0566 - val_balanced_accuracy: 0.5242
Epoch 3/10
37/37 - 0s - loss: 0.4606 - accuracy: 0.8215 - auc: 0.6287 - precision: 0.5062 - recall: 0.0968 - balanced_accuracy: 0.5382 - val_loss: 0.4183 - val_accuracy: 0.8395 - val_auc: 0.7131 - val_precision: 0.8056 - val_recall: 0.1368 - val_balanced_accuracy: 0.5616
Epoch 4/10
37/37 - 0s - loss: 0.4416 - accuracy: 0.8258 - auc: 0.6717 - precision: 0.5632 - recall: 0.1157 - balanced_accuracy: 0.5483 - val_loss: 0.4090 - val_accuracy: 0.8421 - val_auc: 0.7278 - val_precision: 0.8049 - val_recall: 0.1557 - val_balanced_accuracy: 0.5702
Epoch 5/10
37/37 - 1s - loss: 0.4308 - accuracy: 0.8327 - auc: 0.6867 - precision: 0.6368 - recall: 0.1511 - balanced_accuracy: 0.5682 - val_loss: 0.4018 - val_accuracy: 0.8446 - val_auc: 0.7416 - val_precision: 0.8043 - val_recall: 0.1745 - val_balanced_accuracy: 0.5781
Epoch 6/10
37/37 - 0s - loss: 0.4265 - accuracy: 0.8361 - auc: 0.6985 - precision: 0.6511 - recall: 0.1806 - balanced_accuracy: 0.5815 - val_loss: 0.3957 - val_accuracy: 0.8446 - val_auc: 0.7500 - val_precision: 0.7917 - val_recall: 0.1792 - val_balanced_accuracy: 0.5801
Epoch 7/10
37/37 - 0s - loss: 0.4151 - accuracy: 0.8384 - auc: 0.7200 - precision: 0.6680 - recall: 0.1924 - balanced_accuracy: 0.5862 - val_loss: 0.3909 - val_accuracy: 0.8497 - val_auc: 0.7590 - val_precision: 0.8148 - val_recall: 0.2075 - val_balanced_accuracy: 0.5932
Epoch 8/10
37/37 - 0s - loss: 0.4026 - accuracy: 0.8475 - auc: 0.7397 - precision: 0.7530 - recall: 0.2196 - balanced_accuracy: 0.6022 - val_loss: 0.3867 - val_accuracy: 0.8522 - val_auc: 0.7654 - val_precision: 0.8136 - val_recall: 0.2264 - val_balanced_accuracy: 0.6055
Epoch 9/10
37/37 - 1s - loss: 0.3926 - accuracy: 0.8444 - auc: 0.7620 - precision: 0.7068 - recall: 0.2220 - balanced_accuracy: 0.6021 - val_loss: 0.3832 - val_accuracy: 0.8556 - val_auc: 0.7702 - val_precision: 0.7971 - val_recall: 0.2594 - val_balanced_accuracy: 0.6197
Epoch 10/10
37/37 - 0s - loss: 0.3933 - accuracy: 0.8422 - auc: 0.7602 - precision: 0.6748 - recall: 0.2279 - balanced_accuracy: 0.6023 - val_loss: 0.3798 - val_accuracy: 0.8581 - val_auc: 0.7738 - val_precision: 0.7973 - val_recall: 0.2783 - val_balanced_accuracy: 0.6279
Epoch 00010: val_loss improved from inf to 0.37981, saving model to /gpfs0/home/zadubrov/deepFPlearn_exai/example/results_train/AR_single-labeled_Fold-0.model.weights.hdf5
INFO     Computation time for training the single-label model for AR: 0.25 min
Traceback (most recent call last):
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/zadubrov/.conda/envs/dfpl_exai/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 392, in <module>
    main()
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 369, in main
    train(fixed_opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/__main__.py", line 234, in train
    sl.train_single_label_models(df=df, opts=opts)
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 558, in train_single_label_models
    performance = fit_and_evaluate_model(x_train=x_train, x_test=x_test, y_train=y_train, y_test=y_test,
  File "/gpfs0/home/zadubrov/deepFPlearn_exai/dfpl/single_label_model.py", line 435, in fit_and_evaluate_model
    pickle.dump(model, pkl)
TypeError: cannot pickle 'weakref' object